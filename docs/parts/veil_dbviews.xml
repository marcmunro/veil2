<appendix>
  <title><literal>Veil2</literal> Views, Materialized Views and Caches</title>
  <para/>
  <mediaobject>
    <imageobject>
      <imagedata
	  id="veil2_views_div"
	  fileref="veil2_views.png"
	  format="PNG"/>
    </imageobject>
  </mediaobject>
  <sect1>
    <title>Veil2 Views</title>
    <para>
      Establishing whether an accessor has a given privilege in a
      given scope is a complex operation.  Privileges are assigned via
      roles, which may be assigned by other roles, and the contexts in
      which those role assignments occur, and the context of the role
      to role mappings are largely user-defined.  To deal with both
      the complexity, and the need to allow user-customization, we
      determine an accessors privileges through views.
    </para>
    <para>
      For performance reasons, some of these views are materialized.
      Where materialized views alone are not enough we use cache
      tables which are similar in nature to materialized views but:
      <itemizedlist>
	<listitem>
	  are implemented manually;
	</listitem>
	<listitem>
	  can be refreshed incrementally;
	</listitem>
	<listitem>
	  can be indexed.
	</listitem>
      </itemizedlist>
    </para>
    <para>
      The (clickable) diagram above shows the relationship of views
      with each other and with <literal>Veil2</literal>, and other,
      tables. 
    </para>
    <para>
    </para>
    <para>
    </para>
    <sect2 id="view_all_role_roles">
    <title>All Role Roles View</title>
    <sect3>
      <title><literal>all_role_roles</literal></title>
      <?sql-definition view veil2.all_role_roles sql/veil2--&version_number;.sql ?>
    </sect3>
    </sect2>
    <sect2 id="view_all_role_privileges">
      <title>All Role Privileges Views</title>
      <sect3>
        <title><literal>all_role_privileges</literal></title>
        <?sql-definition view veil2.all_role_privileges sql/veil2--&version_number;.sql ?>
      </sect3>
      <sect3>
        <title><literal>all_role_privileges_info</literal></title>
        <?sql-definition view veil2.all_role_privileges_info sql/veil2--&version_number;.sql ?>
      </sect3>
    </sect2>
    <sect2 id="view_accessor_contexts">
      <title>Accessor Contexts View</title>
      <sect3>
        <title><literal>accessor_contexts</literal></title>
        <?sql-definition view veil2.accessor_contexts sql/veil2--&version_number;.sql ?>
      </sect3>
    </sect2>
    <sect2 id="view_superior_scopes">
      <title>Superior Scopes View</title>
      <sect3>
        <title><literal>superior_scopes</literal></title>
        <?sql-definition view veil2.superior_scopes sql/veil2--&version_number;.sql ?>
      </sect3>
    </sect2>
    <sect2 id="view_all_superior_scopes">
      <title>All Superior Scopes Views</title>
      <sect3>
        <title><literal>all_superior_scopes_v</literal></title>
        <?sql-definition view veil2.all_superior_scopes_v sql/veil2--&version_number;.sql ?>
      </sect3>
      <sect3>
        <title><literal>all_superior_scopes</literal></title>
        <?sql-definition view veil2.all_superior_scopes sql/veil2--&version_number;.sql ?>
      </sect3>
    </sect2>
    <sect2 id="view_scope_tree">
      <title>Scope Tree View</title>
      <sect3>
        <title><literal>scope_tree</literal></title>
        <?sql-definition view veil2.scope_tree sql/veil2--&version_number;.sql ?>
      </sect3>
    </sect2>
    <sect2 id="view_promotable_privileges">
      <title>Promotable Privileges Views</title>
      <sect3>
        <title><literal>promotable_privileges</literal></title>
        <?sql-definition view veil2.promotable_privileges sql/veil2--&version_number;.sql ?>
      </sect3>
      <sect3>
        <title><literal>promotable_privileges_info</literal></title>
        <?sql-definition view veil2.promotable_privileges_info sql/veil2--&version_number;.sql ?>
      </sect3>
    </sect2>
    <sect2 id="view_all_accessor_roles">
      <title>All Accessor Roles Views</title>
      <sect3>
        <title><literal>all_accessor_roles</literal></title>
        <?sql-definition view veil2.all_accessor_roles sql/veil2--&version_number;.sql ?>
      </sect3>
      <sect3 id="view_all_accessor_roles_plus">
        <title><literal>all_accessor_roles_plus</literal></title>
        <?sql-definition view veil2.all_accessor_roles_plus sql/veil2--&version_number;.sql ?>
      </sect3>
    </sect2>
    <sect2 id="view_role_chains">
      <title>Role Chains View</title>
      <sect3>
        <title><literal>role_chains</literal></title>
        <?sql-definition view veil2.role_chains sql/veil2--&version_number;.sql ?>
      </sect3>
    </sect2>
    <sect2 id="view_privilege_assignments">
      <title>Privilege Assignments View</title>
      <sect3>
        <title><literal>privilege_assignments</literal></title>
        <?sql-definition view veil2.privilege_assignments sql/veil2--&version_number;.sql ?>
      </sect3>
    </sect2>
    <sect2 id="view_session_assignment_contexts">
      <title><literal>session_assignment_contexts</literal></title>
      <?sql-definition view veil2.session_assignment_contexts sql/veil2--&version_number;.sql ?>
    </sect2>
    <sect2 id="view_all_session_roles">
      <title>All Session Roles View</title>
      <?sql-definition view veil2.all_session_roles sql/veil2--&version_number;.sql ?>
    </sect2>
    <sect2 id="view_session_privileges">
      <title>Session Privileges Views</title>
      <sect3>
        <title><literal>session_privileges_v</literal></title>
        <?sql-definition view veil2.session_privileges_v sql/veil2--&version_number;.sql ?>
      </sect3>
      <sect3 id="view_session_privileges_info">
        <title><literal>session_privileges_info</literal></title>
        <?sql-definition view veil2.session_privileges_info sql/veil2--&version_number;.sql ?>
      </sect3>
    </sect2>
  </sect1>
</appendix>
