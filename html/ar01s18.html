<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>18. Secure Your Tables</title>
<link rel="stylesheet" type="text/css" href="veil2.css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
<link rel="home" href="index.html" title="Veil2 0.9 (beta) Documentation">
<link rel="up" href="index.html" title="Veil2 0.9 (beta) Documentation">
<link rel="prev" href="ar01s17.html" title="17. Create Scope Promotions">
<link rel="next" href="ar01s19.html" title="19. Secure Your Views">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ar01s17.html">Prev</a> </td>
<td width="20%" align="center"> </td>
<td width="40%" align="right"> <a accesskey="n" href="ar01s19.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">17. Create Scope Promotions </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> 19. Secure Your Views</td>
</tr>
</table>
<hr>
</div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="secure_tables"></a>18. Secure Your Tables</h2></div></div></div>
<p>
    At last we get to secure something.
  </p>
<p>
    Each of your user-facing relations should be secured.  Even if you
    think that *all* users should have access to something, it does
    little harm to secure it.  It makes for a more consistent
    implementation and it shows that the relation has not simply been
    forgotten.  The overhead of doing this is small.
  </p>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="idm1173"></a>18.1. Doing It</h3></div></div></div>
<p>
      Securing a table is pretty simple.  First you enable row
      level security for that table, and then you define policies on
      the table for select, insert, update and delete.  The following
      is the definition for the select policy on projects from the
      demo.  See STEP 9 in file <code class="literal">demo/demo.sql</code>.
      </p>
<pre class="programlisting">
alter table demo.projects enable row level security;

create policy parties_tbl__select
    on demo.parties_tbl
   for select
 using (   veil2.i_have_global_priv(17)
        or veil2.i_have_priv_in_scope(17, 3, corp_id)
        or veil2.i_have_priv_in_scope(17, 4, org_id)
        or veil2.i_have_priv_in_scope(17, 4, party_id) -- View the org itself
        or veil2.i_have_personal_priv(17, party_id)
	or (    party_type_id = 2    -- View an org that owns a project
	    and veil2.i_have_priv_in_scope(23, 4, party_id)));
      </pre>
<p>
    </p>
<p>
      Note that we check for <code class="literal">select projects</code>
      privilege in many different ways.  This is because there are
      multiple ways that we could have been assigned the privilege.
      The most interesting test is the last one, which tests for
      <code class="literal">select orgs</code> rather than <code class="literal">select
      parties</code>.  This is to allow someone with that privilege
      to view the party record for the org that is the owner of some
      other record.  In this case, the org will be the owner of a
      project, and a user assigned <code class="literal">select orgs</code> in
      the context of that project will have that privilege
      automatically promoted to org scope allowing them to see the
      party that owns the project, but no other parties.
    </p>
<p>
      Note that the demo only implements the select policy.
    </p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="idm1184"></a>18.2. The <code class="literal">Veil2</code> tables</h3></div></div></div>
<p>
      Each <code class="literal">Veil2</code> table is protected with a select
      privilege.  It is generally assumed that no-one will be granted
      direct access to <code class="literal">Veil2</code> tables, though this
      will not be the case if you use <code class="literal">Veil2</code>'s role
      implementation as the demo does.  In this case you should add
      whatever extra security policies and privileges you need.
    </p>
<p>
      DO NOT GRANT ANY ACCESS OTHER THAN SELECT TO A
      <code class="literal">VEIL2</code> TABLE WITHOUT FIRST ADDING SUITABLE
      PRIVILEGES AND SECURITY POLICIES.
    </p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="idm1193"></a>18.3. In Summary</h3></div></div></div>
<p>
      Create and enable security policies for each user-facing table.
    </p>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ar01s17.html">Prev</a> </td>
<td width="20%" align="center"> </td>
<td width="40%" align="right"> <a accesskey="n" href="ar01s19.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">17. Create Scope Promotions </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> 19. Secure Your Views</td>
</tr>
</table>
</div>
</body>
</html>
