<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Chapter 11. Link Your Users To Veil2's Accessors (STEP 4)</title>
<link rel="stylesheet" type="text/css" href="veil2.css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
<link rel="home" href="index.html" title="Veil2 0.9.3 (beta)">
<link rel="up" href="pt02.html" title="Part II. Creating Your Veil2-based VPD Step By Step">
<link rel="prev" href="ch10.html" title="Chapter 10. Setting Up Authentication and Session Management (STEP 3)">
<link rel="next" href="ch12.html" title="Chapter 12. Link Your Scopes and Security Contexts (STEP 5)">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch10.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="pt02.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="ch12.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 10. Setting Up Authentication and Session Management (STEP 3) </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> Chapter 12. Link Your Scopes and Security Contexts (STEP 5)</td>
</tr>
</table>
<hr>
</div>
<div class="chapter">
<div class="titlepage"><div><div><h2 class="title">
<a name="setup_accessors"></a>Chapter 11. Link Your Users To <code class="literal">Veil2</code>'s Accessors (STEP
  4)</h2></div></div></div>
<p>
    It is likely that your application is going to have tables that
    represent users.  The next stage of your implementation is going
    to be to link your users with <code class="literal">Veil2</code>'s
    accessors.
  </p>
<p>
    Look for STEP 4 in the file
    <code class="literal">veil2_demo--&lt;version&gt;.sql</code>.
  </p>
<p>
    You will need to create links between each of your user tables
    and the <code class="literal"><a class="link" href="apa.html#entity_accessor" title="A.1.9. Accessors Table">veil2.accessors</a></code>
    table.
  </p>
<p>
    You will create foreign-key constraints back to those tables,
    and create triggers to keep the mapping and
    <code class="literal">accessors</code> tables in step with changes in your
    users tables.
  </p>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="idm847"></a>11.1. Create A Mapping Table With Foreign-Key Links to Your Users</h2></div></div></div>
<p>
      You will create a mapping table, ideally in the
      <code class="literal">veil2</code> schema, that will consist of foreign key
      references to both the <code class="literal">veil2.accessors</code> table
      and whatever tables from your database that need you need to link
      to.  You will also create indexes for performance, and
      foreign-key references back to your users tables.
    </p>
<p>
      Note that as a simplification, the demo chooses to use the
      <code class="literal">accessor_id</code> from the
      <code class="literal">accessors</code> table as the primary key for its
      <code class="literal">parties</code> table.
    </p>
</div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="idm856"></a>11.2. Copy Existing User Records</h2></div></div></div>
<p>
      Create copies of the existing user records in
      <code class="literal">veil2.accessors</code>.  Note that you will need to
      create records in both the
      <code class="literal">veil2.accessors</code> and the new mapping table for
      each users record.  See the demo.
    </p>
</div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="idm861"></a>11.3. Copy Existing Authentication Details</h2></div></div></div>
<p>
      What we need to do is populate the 
      <code class="literal"><a class="link" href="apa.html#entity_authentication_detail" title="A.1.16. Authentication Details Table">veil2.authentication_details</a></code>
      table from the authentication details (passwords) in your source
      database.  Depending on how secure your existing system is, this
      may prove to be difficult.  For instance if you use a simple
      salted hash to store your passwords, you will be unable to
      generate a bcrypt password from it.  In this case you have
      2 basic choices:
      </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>
	    implement your current password management scheme in
	    <code class="literal">Veil2</code>;
	  </p>
<p>
	    In this case you will be able to simply copy the current
	    hashed passwords.
	  </p>
</li>
<li class="listitem">
<p>
	    implement a password migration scheme.
	  </p>
<p>
	    You will create bcrypt tokens from the users' passwords,
	    as they enter them into your system. 
	  </p>
</li>
</ul></div>
<p>
    </p>
</div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="idm874"></a>11.4. Create Referential Integrity Triggers</h2></div></div></div>
<p>
      When new users are created, updated or deleted in your users
      table, we need the <code class="literal">veil2.accessors</code> records to
      reflect this.  Triggers on your users tables must be created to
      achieve this.  
    </p>
</div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="idm878"></a>11.5. Ensure Authentication Changes Are Propagated</h2></div></div></div>
<p>
      Ideally, on an ongoing basis, all authentication details will be
      kept solely in <code class="literal">veil2.authentication_details</code>
      and use of the original users tables for this will be
      deprecated.  Until this can be completed though, you may still
      be allowing passwords etc to be created in your original users
      tables.
    </p>
<p>
      To ensure that password changes are propagated to
      <code class="literal">Veil2</code>, triggers should be placed on the
      source tables which will cause the appropriate modifications to
      be made to <code class="literal">veil2.authentication_details</code>.
      Again, examples can be found in the demo code.
    </p>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch10.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="pt02.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="ch12.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 10. Setting Up Authentication and Session Management (STEP 3) </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> Chapter 12. Link Your Scopes and Security Contexts (STEP 5)</td>
</tr>
</table>
</div>
</body>
</html>
